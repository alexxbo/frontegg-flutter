!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).FronteggApp={})}(this,function(t){"use strict";function n(t,r,a,l){return new(a=a||Promise)(function(o,n){function i(t){try{s(l.next(t))}catch(t){n(t)}}function e(t){try{s(l.throw(t))}catch(t){n(t)}}function s(t){var n;t.done?o(t.value):((n=t.value)instanceof a?n:new a(function(t){t(n)})).then(i,e)}s((l=l.apply(t,r||[])).next())})}class o{constructor(t=!1,n){this.disabled=t,this.logger=n,this.log=(t,n,o)=>this.disabled?()=>{}:"function"==typeof this.logger?this.logger:void 0===console.log.bind?Function.prototype.bind.call(console[t],console,n||"",o||"-"):console[t].bind(console,n||"",o||"-"),this.info=null===(n=this.log)||void 0===n?void 0:n.call(this,"log","%c[AdminBox]","background:#e8e8e8;"),this.warn=null===(n=this.log)||void 0===n?void 0:n.call(this,"warn","[AdminBox]"),this.error=null===(n=this.log)||void 0===n?void 0:n.call(this,"error","[AdminBox]")}}var r=function(t,r,a,l){return new(a=a||Promise)(function(o,n){function i(t){try{s(l.next(t))}catch(t){n(t)}}function e(t){try{s(l.throw(t))}catch(t){n(t)}}function s(t){var n;t.done?o(t.value):((n=t.value)instanceof a?n:new a(function(t){t(n)})).then(i,e)}s((l=l.apply(t,r||[])).next())})};function i(t,n){let o=n.querySelector(`#${t}`);return o||(o=document.createElement("div"),o.setAttribute("id",t),n.appendChild(o)),o}var a=function(t,r,a,l){return new(a=a||Promise)(function(o,n){function i(t){try{s(l.next(t))}catch(t){n(t)}}function e(t){try{s(l.throw(t))}catch(t){n(t)}}function s(t){var n;t.done?o(t.value):((n=t.value)instanceof a?n:new a(function(t){t(n)})).then(i,e)}s((l=l.apply(t,r||[])).next())})};class c{constructor(t,n){this.js=[],this.css=[],this.isOpen=!1,this.loaded=!1,this.name="default",this.cdn="https://fronteggdeveustorage.blob.core.windows.net/admin-box",this.version="latest",this.mount=()=>{this.logger.error("App not loaded yet")},this.unmount=()=>{this.logger.error("App not loaded yet")},this.logger=new o(!0),this.logger.info("Create shadow dom element"),this.hostEl=i(`frontegg-host-${t}`,document.body),this.shadowEl=this.hostEl.attachShadow({mode:"open",delegatesFocus:!0}),this.rootEl=i("frontegg-content",this.shadowEl),this.name=t,this.options=n,this.open=this.open.bind(this),this.close=this.close.bind(this),this.destroy=this.destroy.bind(this),this.injectJavascript=this.injectJavascript.bind(this),this.injectCss=this.injectCss.bind(this)}static init(i,e="default"){var s;return a(this,void 0,void 0,function*(){Object.assign(window,{FronteggInjector:c});const t=new c(e,i),{logger:n}=t;c._apps[e]=t,n.info("Initializing Injector instance"),t.cdn=null!==(s=i.cdn)&&void 0!==s?s:t.cdn,t.cdn=t.cdn.endsWith("/")?t.cdn.substring(0,t.cdn.length-1):t.cdn,n.info("Retrieving version metadata");var o=yield function(o,i,e){return r(this,void 0,void 0,function*(){o.info(`Retrieving version from cdn: ${i} version: ${e}`);let t=e;"latest"!==t&&"stable"!==t&&"next"!==t&&(t=`${e}/config`);const n=yield fetch(`${i}/${t}.json`,{cache:"no-cache"});return n.json()})}(n,t.cdn,i.version);t.version=o.version,t.js=o.js,t.css=o.css,n.info("Injector instance initialized successfully",Object.assign({name:e,cdn:t.version},o)),t.loaded=!0,n.info("Loading entrypoint files"),yield t.loadEntrypoints(),n.info("Entrypoint files loaded successfully")})}static getInstance(t="default"){var n=c._apps[t];if(!n)throw Error(`injector instance not found for name: ${t}.\nInject.init(options${"default"===t?"":`, '${t}'`}) must be called`);return n}open(){if(!this.loaded)throw Error(`Injected app [${this.name}] not loaded yet!`);this.mount(this.rootEl,this.options),this.isOpen=!0}close(){if(!this.loaded)throw Error(`Injected app [${this.name}] not loaded yet!`);this.unmount(this.rootEl),this.isOpen=!1}destroy(){delete c._apps[this.name],this.hostEl.remove(),this.logger.info(`${this.name} destroyed`)}loadEntrypoints(){return a(this,void 0,void 0,function*(){return Promise.all([...this.js.map(t=>this.injectJavascript(`${this.cdn}/${this.version}/js/${t}`)),...this.css.map(t=>this.injectCss(`${this.cdn}/${this.version}/css/${t}`))])})}injectJavascript(e){return a(this,void 0,void 0,function*(){const t=this.logger;"string"!=typeof e&&(e=e.src),t.info("Loading JS file from ",e);const n=yield fetch(e,{method:"GET",cache:"default"});let o=yield n.text();const i=document.createElement("script");i.setAttribute("charset","utf-8"),i.setAttribute("type","text/javascript"),o.indexOf("FRONTEGG_INJECTOR_CDN_HOST")&&(o=o.replace("/FRONTEGG_INJECTOR_CDN_HOST",this.cdn),o=`(()=> { const fronteggInjector = FronteggInjector.getInstance('${this.name}');
          ${o}
          })();`),i.innerHTML=o,this.shadowEl.appendChild(i),t.info("JS loaded successfully",e)})}injectCss(i){return new Promise(t=>{const n=this.logger;if("string"==typeof i){n.info("Loading CSS file from ",i);const o=document.createElement("link");o.href=i,o.rel="stylesheet",o.type="text/css",this.shadowEl.prepend(o),o.onload=()=>{n.info("CSS loaded successfully",i),t()}}else n.info("Loading lazy CSS file from ",i.href),this.shadowEl.insertBefore(i,this.rootEl),t()})}}c._apps={};class e{constructor(t,n){var{store:o}=n,n=function(t,n){var o={};for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.indexOf(e)<0&&(o[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,e=Object.getOwnPropertySymbols(t);i<e.length;i++)n.indexOf(e[i])<0&&Object.prototype.propertyIsEnumerable.call(t,e[i])&&(o[e[i]]=t[e[i]]);return o}(n,["store"]);this.loaded=!1,this.loadSubscribers=[],this.storeSubscribers=[],this.onLoad=t=>{this.loadSubscribers.push(t),this.loaded&&t()},this.onStoreChanged=t=>{this.storeSubscribers.push(t)},this.name=t,this.options=n,this.store=o,this.initInjectors()}initInjectors(){var r,a,l,d;return n(this,void 0,void 0,function*(){var t=`${this.name}_admin-portal`,n=`${this.name}_login-box`;try{document.body.classList.add("frontegg-loading")}catch(t){}let o={};if(this.options.metadata)o=null!==(r=this.options.metadata)&&void 0!==r?r:{};else try{const s=yield fetch(`${this.options.contextOptions.baseUrl}/frontegg/metadata?entityName=adminBox`);var i=yield s.json();o=null!==(d=null===(l=null===(a=null==i?void 0:i.rows)||void 0===a?void 0:a[0])||void 0===l?void 0:l.configuration)&&void 0!==d?d:{}}catch(t){console.error("failed to get admin portal metadata",t)}c.init(Object.assign(Object.assign({version:"latest"},this.options),{cdn:`${null!==(d=this.options.cdn)&&void 0!==d?d:"https://assets.frontegg.com"}/admin-box`,metadata:o}),t),this.options.previewMode&&!this.options.customLoginBox||c.init(Object.assign(Object.assign({version:"latest"},this.options),{cdn:`${null!==(d=this.options.cdn)&&void 0!==d?d:"https://assets.frontegg.com"}/login-box`,metadata:o}),n),this.adminPortal=c.getInstance(t),this.options.previewMode&&!this.options.customLoginBox||(this.loginBox=c.getInstance(n));const e=setInterval(()=>{var t,n;null!==(t=this.adminPortal)&&void 0!==t&&t.loaded&&(this.options.previewMode||null!==(n=this.loginBox)&&void 0!==n&&n.loaded)&&this.store&&(clearInterval(e),this.loaded=!0,this.loadSubscribers.forEach(t=>t()),null!==(n=this.store)&&void 0!==n&&n.subscribe(()=>{this.storeSubscribers.forEach(t=>{var n,o=null===(n=null===(o=this.store)||void 0===o?void 0:o.getState)||void 0===n?void 0:n.call(o);o&&t(o)})}))},50);(this.adminPortal.app=this).options.previewMode&&!this.options.customLoginBox||(this.loginBox.app=this)})}static getInstance(t){var n=e._apps[t];if(!n)throw Error(`Frontegg instance not found for name: ${t}.\nFrontegg.initialize(options${"default"===t?"":`, '${t}'`}) must be called`);return n}static setConfig(t,n="default"){let o=e._apps[n];return o?console.warn(`Frontegg instance already initialized for name: ${n}`):(o=new e(n,t),e._apps[n]=o),o}static getConfig(t="default"){return e.getInstance(t)}mountAdminPortal(){var t;null!==(t=this.adminPortal)&&void 0!==t&&t.open()}unmountAdminPortal(){var t;null!==(t=this.adminPortal)&&void 0!==t&&t.close()}mountLoginBox(){var t;null!==(t=this.loginBox)&&void 0!==t&&t.open()}unmountLoginBox(){var t;null!==(t=this.loginBox)&&void 0!==t&&t.close()}}e._apps={};var s=(t,n="default")=>e.setConfig(t,n),l={show:(t="default")=>{e.getConfig(t).mountAdminPortal()},hide:(t="default")=>{e.getConfig(t).unmountAdminPortal()}},d={show:(t="default")=>{e.getConfig(t).mountLoginBox()},hide:(t="default")=>{e.getConfig(t).unmountLoginBox()}};"undefined"!=typeof window&&Object.assign(window,{FronteggApp:e,AdminPortal:l,LoginBox:d,Frontegg:{initialize:s}}),t.AdminPortal=l,t.LoginBox=d,t.initialize=s,Object.defineProperty(t,"__esModule",{value:!0})});
